<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.12.0 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="ko" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Kaggle Toxic Classification (2) Preprocessing - Inspiring People</title>
<meta name="description" content="Toxic Comment Classification Kaggle 대회 : 링크">



<meta property="og:type" content="article">
<meta property="og:locale" content="ko">
<meta property="og:site_name" content="Inspiring People">
<meta property="og:title" content="Kaggle Toxic Classification (2) Preprocessing">
<meta property="og:url" content="http://localhost:4000/data%20analysis/Toxic_Preprocessing/">


  <meta property="og:description" content="Toxic Comment Classification Kaggle 대회 : 링크">



  <meta property="og:image" content="http://localhost:4000/assets/img/teaser.png">





  <meta property="article:published_time" content="2018-10-16T00:00:00+09:00">





  

  


<link rel="canonical" href="http://localhost:4000/data%20analysis/Toxic_Preprocessing/">





  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "http://localhost:4000",
      "logo": "http://localhost:4000/assets/img/teaser.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "YounKyung Jang",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Inspiring People Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/">Inspiring People</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/categories/" >Category</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/tags/" >Tag</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/archive/" >Archive</a>
            </li>
          
        </ul>
        
        <button class="search__toggle" type="button">
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">토글 메뉴</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/img/profile.jpg" alt="YounKyung Jang" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">YounKyung Jang</h3>
    
    
      <p class="author__bio" itemprop="description">
        자세히 보아야 아름답다. 너도 그렇다
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">팔로우</button>
    <ul class="author__urls social-icons">
      

      

      
        <li>
          <a href="mailto:ykjang@gmail.com">
            <meta itemprop="email" content="ykjang@gmail.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> 이메일
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/InspiringPeople" itemprop="sameAs">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      
        
          <li>
            <a href="https://youtube.com/dearpiano" itemprop="sameAs">
              <i class="fab fa-fw fa-youtube" aria-hidden="true"></i> YouTube
            </a>
          </li>
        
      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>  

  
    <div class="author__avatar2">
      

      
        <img src="/assets/img/profile2.jpg" alt="YounKyung Jang" itemprop="image">
      
    </div>
  
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Kaggle Toxic Classification (2) Preprocessing">
    <meta itemprop="description" content="Toxic Comment Classification Kaggle 대회 : 링크">
    <meta itemprop="datePublished" content="October 16, 2018">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Kaggle Toxic Classification (2) Preprocessing
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On This Page</h4></header>
              <ul class="toc__menu">
  <li><a href="#definition-library--functions">Definition (Library &amp; Functions)</a></li>
  <li><a href="#preprocessing-train--test-data">Preprocessing train / test data</a></li>
  <li><a href="#reference">Reference</a></li>
</ul>
            </nav>
          </aside>
        
        <p>Toxic Comment Classification Kaggle 대회 : <a href="https://www.kaggle.com/c/jigsaw-toxic-comment-classification-challenge">링크</a></p>

<p>지난 포스트<br />
(1) <a href="https://inspiringpeople.github.io/data%20analysis/Toxic_EDA/">Toxic Classification EDA</a></p>

<p>train / test data에 대해 Text 전처리 하는 부분이다.<br />
기본적인 소문자화, 숫자 제거, 축약어 풀기 등 외에도 중복 알파벳, 중복 단어 제거 등의 로직이 있다.</p>

<h2 id="definition-library--functions">Definition (Library &amp; Functions)</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span> 
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="k">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">"./input"</span><span class="p">))</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c"># Replace all numeric with 'n'</span>
<span class="n">replace_numbers</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'\d+'</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>

<span class="n">COMMENT_COL</span> <span class="o">=</span> <span class="s">'comment_text'</span>
<span class="n">ID_COL</span> <span class="o">=</span> <span class="s">'id'</span>
<span class="n">input_dir</span> <span class="o">=</span> <span class="s">'./input/'</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="s">'./input/'</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['sample_submission.csv', 'test_labels.csv', '.ipynb_checkpoints', 'test.csv', 'imagesforkernal', 'train.csv']
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># redundancy words and their right formats</span>
<span class="n">redundancy_rightFormat</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'ckckck'</span><span class="p">:</span> <span class="s">'cock'</span><span class="p">,</span>
    <span class="s">'fuckfuck'</span><span class="p">:</span> <span class="s">'fuck'</span><span class="p">,</span>
    <span class="s">'lolol'</span><span class="p">:</span> <span class="s">'lol'</span><span class="p">,</span>
    <span class="s">'lollol'</span><span class="p">:</span> <span class="s">'lol'</span><span class="p">,</span>
    <span class="s">'pussyfuck'</span><span class="p">:</span><span class="s">'fuck'</span><span class="p">,</span>
    <span class="s">'gaygay'</span><span class="p">:</span> <span class="s">'gay'</span><span class="p">,</span>
    <span class="s">'haha'</span><span class="p">:</span> <span class="s">'ha'</span><span class="p">,</span>
    <span class="s">'sucksuck'</span><span class="p">:</span> <span class="s">'suck'</span><span class="p">}</span>

<span class="n">redundancy</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">redundancy_rightFormat</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c"># all the words below are included in glove dictionary</span>
<span class="c"># combine these toxic indicators with 'CommProcess.revise_triple_and_more_letters'</span>
<span class="n">toxic_indicator_words</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">'fuck'</span><span class="p">,</span> <span class="s">'fucking'</span><span class="p">,</span> <span class="s">'fucked'</span><span class="p">,</span> <span class="s">'fuckin'</span><span class="p">,</span> <span class="s">'fucka'</span><span class="p">,</span> <span class="s">'fucker'</span><span class="p">,</span> <span class="s">'fucks'</span><span class="p">,</span> <span class="s">'fuckers'</span><span class="p">,</span>
    <span class="s">'fck'</span><span class="p">,</span> <span class="s">'fcking'</span><span class="p">,</span> <span class="s">'fcked'</span><span class="p">,</span> <span class="s">'fckin'</span><span class="p">,</span> <span class="s">'fcker'</span><span class="p">,</span> <span class="s">'fcks'</span><span class="p">,</span>
    <span class="s">'fuk'</span><span class="p">,</span> <span class="s">'fuking'</span><span class="p">,</span> <span class="s">'fuked'</span><span class="p">,</span> <span class="s">'fukin'</span><span class="p">,</span> <span class="s">'fuker'</span><span class="p">,</span> <span class="s">'fuks'</span><span class="p">,</span> <span class="s">'fukers'</span><span class="p">,</span>
    <span class="s">'fk'</span><span class="p">,</span> <span class="s">'fking'</span><span class="p">,</span> <span class="s">'fked'</span><span class="p">,</span> <span class="s">'fkin'</span><span class="p">,</span> <span class="s">'fker'</span><span class="p">,</span> <span class="s">'fks'</span><span class="p">,</span>
    <span class="s">'shit'</span><span class="p">,</span> <span class="s">'shitty'</span><span class="p">,</span> <span class="s">'shite'</span><span class="p">,</span>
    <span class="s">'stupid'</span><span class="p">,</span> <span class="s">'stupids'</span><span class="p">,</span>
    <span class="s">'idiot'</span><span class="p">,</span> <span class="s">'idiots'</span><span class="p">,</span>
    <span class="s">'suck'</span><span class="p">,</span> <span class="s">'sucker'</span><span class="p">,</span> <span class="s">'sucks'</span><span class="p">,</span> <span class="s">'sucka'</span><span class="p">,</span> <span class="s">'sucked'</span><span class="p">,</span> <span class="s">'sucking'</span><span class="p">,</span>
    <span class="s">'ass'</span><span class="p">,</span> <span class="s">'asses'</span><span class="p">,</span> <span class="s">'asshole'</span><span class="p">,</span> <span class="s">'assholes'</span><span class="p">,</span> <span class="s">'ashole'</span><span class="p">,</span> <span class="s">'asholes'</span><span class="p">,</span>
    <span class="s">'gay'</span><span class="p">,</span> <span class="s">'gays'</span><span class="p">,</span>
    <span class="s">'niga'</span><span class="p">,</span> <span class="s">'nigga'</span><span class="p">,</span> <span class="s">'nigar'</span><span class="p">,</span> <span class="s">'niggar'</span><span class="p">,</span> <span class="s">'niger'</span><span class="p">,</span> <span class="s">'nigger'</span><span class="p">,</span>
    <span class="s">'monster'</span><span class="p">,</span> <span class="s">'monsters'</span><span class="p">,</span>
    <span class="s">'loser'</span><span class="p">,</span> <span class="s">'losers'</span><span class="p">,</span>
    <span class="s">'nazi'</span><span class="p">,</span> <span class="s">'nazis'</span><span class="p">,</span>
    <span class="s">'cock'</span><span class="p">,</span> <span class="s">'cocks'</span><span class="p">,</span> <span class="s">'cocker'</span><span class="p">,</span> <span class="s">'cockers'</span><span class="p">,</span>
    <span class="s">'faggot'</span><span class="p">,</span> <span class="s">'faggy'</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">toxic_indicator_words_sets</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">toxic_indicator_words</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">redundancy</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">toxic_indicator_words_sets</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{'lolol', 'sucksuck', 'gaygay', 'lollol', 'ckckck', 'pussyfuck', 'fuckfuck', 'haha'}
{'niggar', 'niga', 'nigga', 'monsters', 'fuks', 'fcked', 'fuked', 'fucka', 'stupids', 'fucker', 'fck', 'fk', 'fucked', 'fks', 'asholes', 'monster', 'fcks', 'ass', 'loser', 'fckin', 'faggot', 'niger', 'sucking', 'fuk', 'shit', 'idiots', 'cocks', 'fukin', 'fuckers', 'gays', 'fkin', 'nigar', 'cock', 'fked', 'nazis', 'asses', 'fukers', 'ashole', 'faggy', 'shite', 'fker', 'sucka', 'fuckin', 'fuker', 'shitty', 'asshole', 'cocker', 'fucking', 'fuking', 'idiot', 'stupid', 'fking', 'suck', 'fuck', 'fcking', 'sucker', 'assholes', 'losers', 'gay', 'nazi', 'fcker', 'sucks', 'nigger', 'cockers', 'fucks', 'sucked'}
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">deny_origin</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"you're"</span><span class="p">:</span> <span class="p">[</span><span class="s">'you'</span><span class="p">,</span> <span class="s">'are'</span><span class="p">],</span>
    <span class="s">"i'm"</span><span class="p">:</span> <span class="p">[</span><span class="s">'i'</span><span class="p">,</span> <span class="s">'am'</span><span class="p">],</span>
    <span class="s">"he's"</span><span class="p">:</span> <span class="p">[</span><span class="s">'he'</span><span class="p">,</span> <span class="s">'is'</span><span class="p">],</span>
    <span class="s">"she's"</span><span class="p">:</span> <span class="p">[</span><span class="s">'she'</span><span class="p">,</span> <span class="s">'is'</span><span class="p">],</span>
    <span class="s">"it's"</span><span class="p">:</span> <span class="p">[</span><span class="s">'it'</span><span class="p">,</span> <span class="s">'is'</span><span class="p">],</span>
    <span class="s">"they're"</span><span class="p">:</span> <span class="p">[</span><span class="s">'they'</span><span class="p">,</span> <span class="s">'are'</span><span class="p">],</span>
    <span class="s">"can't"</span><span class="p">:</span> <span class="p">[</span><span class="s">'can'</span><span class="p">,</span> <span class="s">'not'</span><span class="p">],</span>
    <span class="s">"couldn't"</span><span class="p">:</span> <span class="p">[</span><span class="s">'could'</span><span class="p">,</span> <span class="s">'not'</span><span class="p">],</span>
    <span class="s">"don't"</span><span class="p">:</span> <span class="p">[</span><span class="s">'do'</span><span class="p">,</span> <span class="s">'not'</span><span class="p">],</span>
    <span class="s">"don;t"</span><span class="p">:</span> <span class="p">[</span><span class="s">'do'</span><span class="p">,</span> <span class="s">'not'</span><span class="p">],</span>
    <span class="s">"didn't"</span><span class="p">:</span> <span class="p">[</span><span class="s">'did'</span><span class="p">,</span> <span class="s">'not'</span><span class="p">],</span>
    <span class="s">"doesn't"</span><span class="p">:</span> <span class="p">[</span><span class="s">'does'</span><span class="p">,</span> <span class="s">'not'</span><span class="p">],</span>
    <span class="s">"isn't"</span><span class="p">:</span> <span class="p">[</span><span class="s">'is'</span><span class="p">,</span> <span class="s">'not'</span><span class="p">],</span>
    <span class="s">"wasn't"</span><span class="p">:</span> <span class="p">[</span><span class="s">'was'</span><span class="p">,</span> <span class="s">'not'</span><span class="p">],</span>
    <span class="s">"aren't"</span><span class="p">:</span> <span class="p">[</span><span class="s">'are'</span><span class="p">,</span> <span class="s">'not'</span><span class="p">],</span>
    <span class="s">"weren't"</span><span class="p">:</span> <span class="p">[</span><span class="s">'were'</span><span class="p">,</span> <span class="s">'not'</span><span class="p">],</span>
    <span class="s">"won't"</span><span class="p">:</span> <span class="p">[</span><span class="s">'will'</span><span class="p">,</span> <span class="s">'not'</span><span class="p">],</span>
    <span class="s">"wouldn't"</span><span class="p">:</span> <span class="p">[</span><span class="s">'would'</span><span class="p">,</span> <span class="s">'not'</span><span class="p">],</span>
    <span class="s">"hasn't"</span><span class="p">:</span> <span class="p">[</span><span class="s">'has'</span><span class="p">,</span> <span class="s">'not'</span><span class="p">],</span>
    <span class="s">"haven't"</span><span class="p">:</span> <span class="p">[</span><span class="s">'have'</span><span class="p">,</span> <span class="s">'not'</span><span class="p">],</span>
    <span class="s">"what's"</span><span class="p">:</span> <span class="p">[</span><span class="s">'what'</span><span class="p">,</span> <span class="s">'is'</span><span class="p">],</span>
    <span class="s">"that's"</span><span class="p">:</span> <span class="p">[</span><span class="s">'that'</span><span class="p">,</span> <span class="s">'is'</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">denies</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">deny_origin</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="k">print</span><span class="p">(</span><span class="n">denies</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{"wouldn't", "they're", "that's", "doesn't", "it's", "wasn't", "can't", "you're", "weren't", "don't", "hasn't", "he's", "didn't", "won't", "what's", "haven't", "i'm", "aren't", 'don;t', "isn't", "couldn't", "she's"}
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">_get_toxicIndicator_transformers</span><span class="p">():</span>
    <span class="n">toxicIndicator_transformers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">toxic_indicator_words</span><span class="p">:</span>
        <span class="n">tmp_1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tmp_2</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">pre</span> <span class="ow">in</span> <span class="n">tmp_1</span><span class="p">:</span>
                    <span class="n">tmp_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pre</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>
                    <span class="n">tmp_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pre</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>
                <span class="n">tmp_1</span> <span class="o">=</span> <span class="n">tmp_2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tmp_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="n">tmp_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>
        <span class="n">toxicIndicator_transformers</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_1</span>
    <span class="k">return</span> <span class="n">toxicIndicator_transformers</span>


<span class="n">toxicIndicator_transformers</span> <span class="o">=</span> <span class="n">_get_toxicIndicator_transformers</span><span class="p">()</span>
</code></pre></div></div>

<p><strong>Functions</strong></p>
<ul>
  <li>clean_text : 알파벳, 특수기호만 남기고 숫자는 공백 처리, 소문자화, 특수기호는 앞뒤 공백 추가</li>
  <li>revise_deny : 사전 정의된 축약어를 full words로 변환</li>
  <li>revise_star : * 공백 치환</li>
  <li>revise_triple_and_more_letters : 중복된 알파벳을 최대 2개 중복 알파벳으로 변환 (aaaaaaaa -&gt; aa)</li>
  <li>revise_redundancy_words : 사전정의된 redundancy words의 중복단어 제거</li>
  <li>fill_na : “” string을 NA로 치환</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CommProcess</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">clean_text</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r"[^A-Za-z0-9,!?*.;’´'\/]"</span><span class="p">,</span> <span class="s">" "</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">replace_numbers</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">" "</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r","</span><span class="p">,</span> <span class="s">" "</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r"’"</span><span class="p">,</span> <span class="s">"'"</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r"´"</span><span class="p">,</span> <span class="s">"'"</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r"\."</span><span class="p">,</span> <span class="s">" "</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r"!"</span><span class="p">,</span> <span class="s">" ! "</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r"\?"</span><span class="p">,</span> <span class="s">" ? "</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r"\/"</span><span class="p">,</span> <span class="s">" "</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">revise_deny</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">denies</span><span class="p">:</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deny_origin</span><span class="p">[</span><span class="n">word</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deny_origin</span><span class="p">[</span><span class="n">word</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>                
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="s">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">"'"</span><span class="p">,</span> <span class="s">" "</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r";"</span><span class="p">,</span> <span class="s">" "</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">revise_star</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>            
            <span class="k">if</span> <span class="p">(</span><span class="s">'*'</span> <span class="ow">in</span> <span class="n">word</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">'</span><span class="err">\</span><span class="s">*'</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span> <span class="ow">in</span> <span class="n">toxic_indicator_words_sets</span><span class="p">):</span>
                <span class="n">word</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">'</span><span class="err">\</span><span class="s">*'</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">'</span><span class="err">\</span><span class="s">*'</span><span class="p">,</span> <span class="s">' '</span><span class="p">,</span> <span class="s">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">revise_triple_and_more_letters</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="s">'abcdefghijklmnopqrstuvwxyz'</span><span class="p">:</span>
            <span class="n">reg</span> <span class="o">=</span> <span class="n">letter</span> <span class="o">+</span> <span class="s">"{2,}"</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">letter</span> <span class="o">+</span> <span class="n">letter</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">revise_redundancy_words</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">redu</span> <span class="ow">in</span> <span class="n">redundancy</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">redu</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
                    <span class="n">word</span> <span class="o">=</span> <span class="n">redundancy_rightFormat</span><span class="p">[</span><span class="n">redu</span><span class="p">]</span>
                    <span class="k">break</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fill_na</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">'NA'</span>
        <span class="k">return</span> <span class="n">t</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_dir</span> <span class="o">+</span> <span class="s">'train.csv'</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">df_train</span><span class="p">[</span><span class="s">'toxic'</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">execute_comm_process</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                  id                                       comment_text  \
6   0002bcb3da6cb337       COCKSUCKER BEFORE YOU PISS AROUND ON MY WORK   
12  0005c987bdfc9d4b  Hey... what is it..\n@ | talk .\nWhat is it......   
16  0007e25b2121310b  Bye! \n\nDon't look, come or think of comming ...   
42  001810bf8c45bf5f  You are gay or antisemmitian? \n\nArchangel WH...   
43  00190820581d90ce           FUCK YOUR FILTHY MOTHER IN THE ASS, DRY!   

    toxic  severe_toxic  obscene  threat  insult  identity_hate  
6       1             1        1       0       1              0  
12      1             0        0       0       0              0  
16      1             0        0       0       0              0  
42      1             0        1       0       1              1  
43      1             0        1       0       1              0  
                  id                                       comment_text  \
6   0002bcb3da6cb337       cocksucker before you piss around on my work   
12  0005c987bdfc9d4b  hey what is it talk what is it an exclusive gr...   
16  0007e25b2121310b  bye ! do not look come or think of comming bac...   
42  001810bf8c45bf5f  you are gay or antisemmitian ? archangel white...   
43  00190820581d90ce           fuck your filthy mother in the ass dry !   

    toxic  severe_toxic  obscene  threat  insult  identity_hate  
6       1             1        1       0       1              0  
12      1             0        0       0       0              0  
16      1             0        0       0       0              0  
42      1             0        1       0       1              1  
43      1             0        1       0       1              0  
</code></pre></div></div>

<p>apply 함수로 CommProcess 안의 function 들을 각 comment에 대해 차례대로 모두 적용</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">execute_comm_process</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">comm_process_pipeline</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">CommProcess</span><span class="o">.</span><span class="n">clean_text</span><span class="p">,</span>
        <span class="n">CommProcess</span><span class="o">.</span><span class="n">revise_deny</span><span class="p">,</span>
        <span class="n">CommProcess</span><span class="o">.</span><span class="n">revise_star</span><span class="p">,</span>
        <span class="n">CommProcess</span><span class="o">.</span><span class="n">revise_triple_and_more_letters</span><span class="p">,</span>
        <span class="n">CommProcess</span><span class="o">.</span><span class="n">revise_redundancy_words</span><span class="p">,</span>
        <span class="n">CommProcess</span><span class="o">.</span><span class="n">fill_na</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">cp</span> <span class="ow">in</span> <span class="n">comm_process_pipeline</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">COMMENT_COL</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">COMMENT_COL</span><span class="p">]</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

</code></pre></div></div>

<h2 id="preprocessing-train--test-data">Preprocessing train / test data</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Process whole train data</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Comm processing whole train data'</span><span class="p">)</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_dir</span> <span class="o">+</span> <span class="s">'train.csv'</span><span class="p">)</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="n">execute_comm_process</span><span class="p">(</span><span class="n">df_train</span><span class="p">)</span>
<span class="n">df_train</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'train_processed.csv'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c"># Process test data</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Comm processing test data'</span><span class="p">)</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_dir</span> <span class="o">+</span> <span class="s">'test.csv'</span><span class="p">)</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">execute_comm_process</span><span class="p">(</span><span class="n">df_test</span><span class="p">)</span>
<span class="n">df_test</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'test_processed.csv'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Comm processing whole train data
Comm processing test data
</code></pre></div></div>

<h2 id="reference">Reference</h2>
<ul>
  <li>https://www.kaggle.com/c/jigsaw-toxic-comment-classification-challenge/discussion/52644</li>
  <li>https://www.kaggle.com/xbf6xbf/processing-helps-boosting-about-0-0005-on-lb</li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> 태그: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#data-analysis" class="page__taxonomy-item" rel="tag">Data Analysis</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#kaggle" class="page__taxonomy-item" rel="tag">Kaggle</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#preprocessing" class="page__taxonomy-item" rel="tag">preprocessing</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#toxic-classification" class="page__taxonomy-item" rel="tag">toxic classification</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> 카테고리: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#data-analysis" class="page__taxonomy-item" rel="tag">Data Analysis</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 업데이트:</strong> <time datetime="2018-10-16T00:00:00+09:00">October 16, 2018</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/data%20analysis/Toxic_EDA/" class="pagination--pager" title="Kaggle Toxic Classification (1) EDA
">이전</a>
    
    
      <a href="/writing/thougts/" class="pagination--pager" title="감옥으로부터의 사색 중에서
">다음</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">참고</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/kaggle_kernel/" rel="permalink">Kaggle_kernel
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/writing/sapiens_nongup/" rel="permalink">사피엔스 필사2_농업혁명
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">사피엔스 제 2장. 농업혁명 관련 필사
(손 필사… 힘들다… ;;)
  












</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/writing/thougts/" rel="permalink">감옥으로부터의 사색 중에서
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">
  없는 사람이 살기는 겨울보다 여름이 낫다고 하지만 교도소의 우리들은 없이 살기는 더합니다만 차라리 겨울을 택합니다. 왜냐하면 여름 징역의 열 가지 스무 가지 장점을 일시에 무색케 해버리는 결정적인 사실 ― 여름 징역은 자기의 바로 옆사람을 증오하게 한다는 사실 때문입니다.

...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/data%20analysis/Toxic_EDA/" rel="permalink">Kaggle Toxic Classification (1) EDA
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Introduction

</p>
  </article>
</div>
        
      </div>
    </div>
  
  
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
  <input type="text" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  <div id="results" class="results"></div>
</div>
      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>팔로우:</strong></li>
    
    
    
    
      <li><a href="https://github.com/InspiringPeople"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
	
      <li><a href="https://youtube.com/dearpiano"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i> youtube</a></li>
    
    
    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> 피드</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 YounKyung Jang. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>


      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.1.0/js/all.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-121538180-1']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>





    
  <script>
    var disqus_config = function () {
      this.page.url = "http://localhost:4000/data%20analysis/Toxic_Preprocessing/";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/data%20analysis/Toxic_Preprocessing"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://https-inspiringpeople-github-io.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  



  </body>
</html>